(function(t){t.qjax=function(o){var n=t.extend({timeout:null,onStart:null,onStop:null,onError:null,onTimeout:null,onQueueChange:null,queueChangeDelay:0,ajaxSettings:{url:"",timeout:5e3,contentType:"application/json; charset=utf-8",dataType:"json",type:"POST"}},o),e=[],i=null,u=null,r=this,s=!1,l=function(){s||(s=!0,n.onTimeout&&n.timeout&&t.isFunction(n.onTimeout)&&(u&&clearTimeout(u),u=setTimeout(t.proxy(function(){n.onTimeout.call(this,i.options)},this),n.timeout)),n.onStart&&t.isFunction(n.onStart)&&n.onStart(this,i.options))},a=function(){s&&0>=e.length&&(s=!1,u&&clearTimeout(u),n.onStop&&t.isFunction(n.onStop)&&n.onStop(this,i.options))},p=function(){if(n.onQueueChange&&n.onQueueChange.call(r,e.length),e.length>=1&&!i)if(i=e.shift(),i.options.isCallback)i.options.complete();else{l();var o=t.ajax(i.options);for(var u in i.promise)for(var s in i.promise[u])o[u].call(this,i.promise[u][s])}},c=function(t,o,n){this.options=t,this.complete=o,this.context=n,this.promise={done:[],then:[],always:[],fail:[]}};return c.prototype._promise=function(t,o){return this.promise[t]&&this.promise[t].push(o),this},c.prototype.done=function(t){return this._promise("done",t)},c.prototype.then=function(t){return this._promise("then",t)},c.prototype.always=function(t){return this._promise("always",t)},c.prototype.fail=function(t){return this._promise("fail",t)},this.Clear=function(){e=[]},this.Queue=function(o,u){var r={},s=null;o instanceof Function?(r={isCallback:!0},s=o):(r=t.extend({},n.ajaxSettings,o||{}),s=r.complete),r.complete=function(o,e){"error"==e&&n.onError&&t.isFunction(n.onError)&&n.onError.call(i.context||this,o,e),i&&(i.complete&&i.complete.call(i.context||this,o,e),a(),i=null,p())};var o=new c(r,s,u);return e.push(o),setTimeout(p,n.queueChangeDelay),o},this}})(jQuery);